<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>QuakePredictEC</title>
    <link rel="stylesheet" href="styles.css" />
    <link href="https://unpkg.com/maplibre-gl@3.6.2/dist/maplibre-gl.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
</head>

<body>

    <header>
        <img class="logo" src="logo.jpg" alt="QuakePredictEC"
            style="height:50px;width:50px;border-radius:10px;margin-right:10px" />
        <div>
            <h1>QuakePredictEC</h1>
            <div class="subtitle">An√°lisis y predicci√≥n de sismos asociados a variaci√≥n clim√°tica en Ecuador</div>
        </div>

        <button id="btnTheme" class="chip" style="margin-left:auto;cursor:pointer;">
            üåô Modo oscuro
        </button>

        <span id="userLabel" class="chip" style="display:none;">
            üë§ Usuario
        </span>

        <button id="btnLogin" class="chip" style="margin-left:8px;cursor:pointer;display:none;">
            Iniciar sesi√≥n
        </button>

        <button id="btnLogout" class="chip" style="margin-left:8px;cursor:pointer;display:none;">
            Cerrar sesi√≥n
        </button>

    </header>

    <div class="container">
        <nav>
            <div class="section">

                <!-- TAB MAPA -->
                <div class="tab" data-tab="mapa">
                    <span class="dot" style="background: var(--accent2)"></span>
                    <div>Mapa de Riesgo</div>
                </div>

                <!-- TAB REPORTES -->
                <div class="tab" data-tab="datos">
                    <span class="dot" style="background: #60a5fa"></span>
                    <div>Reportes del Modelo</div>
                </div>

                <!-- TAB ALERTAS (CON BADGE ROJO) -->
                <div class="tab" data-tab="alertas">
                    <span class="dot" style="background: #f87171"></span>
                    <div style="display:flex;align-items:center;gap:6px">
                        Alertas
                        <span id="alertBadge" class="badge" style="background:#ef4444;color:white;padding:2px 6px;border-radius:10px;
                              font-size:12px;font-weight:700;display:none;">
                            1
                        </span>
                    </div>
                </div>

            </div>
        </nav>

        <main>

            <!-- Mapa -->
            <section id="view-mapa">
                <div class="toolbar">
                    <label for="fProvincia">Provincia</label><br />
                    <select id="fProvincia">
                        <option value="all">Todas</option>
                        <option>Azuay</option>
                        <option>Bol√≠var</option>
                        <option>Ca√±ar</option>
                        <option>Carchi</option>
                        <option>Chimborazo</option>
                        <option>Cotopaxi</option>
                        <option>El Oro</option>
                        <option>Esmeraldas</option>
                        <option>Gal√°pagos</option>
                        <option>Guayas</option>
                        <option>Imbabura</option>
                        <option>Loja</option>
                        <option>Los R√≠os</option>
                        <option>Manab√≠</option>
                        <option>Morona Santiago</option>
                        <option>Napo</option>
                        <option>Orellana</option>
                        <option>Pastaza</option>
                        <option>Pichincha</option>
                        <option>Santa Elena</option>
                        <option>Santo Domingo de los Ts√°chilas</option>
                        <option>Sucumb√≠os</option>
                        <option>Tungurahua</option>
                        <option>Zamora Chinchipe</option>
                    </select>
                </div>

                <div class="card">
                    <h3>Mapa de riesgo</h3>
                    <div id="map-ec" style="height:480px;border:1px solid #1f2937;border-radius:10px"></div>
                    <!-- OVERLAY DE CARGA -->
                    <div id="mapLoading" class="map-loading" style="display:none;">
                        <div class="map-loading-card">
                            <div class="spinner"></div>
                            <div style="font-weight:700;margin-top:10px;">Cargando predicciones‚Ä¶</div>
                            <div style="font-size:12px;color:var(--muted);margin-top:4px;">
                                Conectando con datos sismicos recientes
                            </div>
                        </div>
                    </div>
            </section>

            <!-- Datos -->
            <section id="view-datos" hidden>
                <div class="toolbar" style="margin-top:0">
                    <div>
                        <label>Buscar</label><br>
                        <input id="fSearch" placeholder="fecha o cant√≥n">
                    </div>

                    <div style="align-self:end;margin-left:auto;display:flex;gap:6px;align-items:center">
                        <span class="badge" id="count">0</span>
                        <button id="btnPrev" class="chip">Anterior</button>
                        <button id="btnNext" class="chip">Siguiente</button>
                    </div>
                </div>

                <div class="card">
                    <h3>Reportes del Modelo</h3>
                    <div id="table" style="max-height:320px;overflow:auto;border:1px solid #1f2937;border-radius:10px">
                        <table style="width:100%;border-collapse:collapse;font-size:13px">
                            <thead>
                                <tr class="table-head">
                                    <th data-sort="fecha"
                                        style="text-align:left;padding:12px;border-bottom:1px solid #1f2937;cursor:pointer">
                                        Fecha ‚¨ç
                                    </th>

                                    <th data-sort="region"
                                        style="text-align:left;padding:12px;border-bottom:1px solid #1f2937;cursor:pointer">
                                        Ubicaci√≥n
                                    </th>

                                    <th data-sort="probabilidad"
                                        style="text-align:left;padding:12px;border-bottom:1px solid #1f2937;cursor:pointer">
                                        Probabilidad estimada
                                    </th>

                                    <th data-sort="nivel"
                                        style="text-align:left;padding:12px;border-bottom:1px solid #1f2937;cursor:pointer">
                                        Nivel de Probabilidad
                                    </th>
                                </tr>
                            </thead>
                            <tbody id="rows"></tbody>
                        </table>
                    </div>
                    <div style="margin-top:10px">
                        <button id="btnCSV"
                            style="background:#60a5fa;border:0;color:#071018;padding:10px 14px;border-radius:10px;font-weight:700;cursor:pointer">
                            Descargar CSV
                        </button>

                        <p id="msgLoginCSV" style="margin-top:6px;font-size:12px;color:#f87171;display:none;">
                            Debes iniciar sesi√≥n para poder descargar los reportes.
                        </p>
                    </div>

                </div>
            </section>
            <!-- bloque de alertas  -->
            <section id="view-alertas" hidden>

                <div class="card">
                    <h3>üîî Alertas activas</h3>

                    <ul id="alerts" style="list-style:none;padding-left:0;margin-top:8px"></ul>
                </div>

                <!--BLOQUE DE SUSCRIPCI√ìN-->
                <div id="subscriptionCard" class="card" style="margin-top:20px">
                    <h3>üì© Suscripci√≥n a alertas</h3>
                    <p style="font-size:13px;color:var(--muted); margin-bottom: 10px;">
                        Busca y selecciona las ciudades donde deseas recibir alertas:
                    </p>
                    <select id="select-cities" multiple placeholder="Escribe para buscar (ej: Quito)..."
                        autocomplete="off">
                    </select>
                    <button id="btnSubscribe" class="chip"
                        style="margin-top:12px;background:#22d3ee;color:#020617;font-weight:700; border:none; cursor:pointer;">
                        ‚úÖ Guardar Suscripciones
                    </button>
                    <p id="subMsg" style="font-size:12px;margin-top:8px;color:#34d399;display:none">
                        ‚úî Suscripci√≥n guardada correctamente
                    </p>
                </div>
            </section>
        </main>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://unpkg.com/maplibre-gl@3.6.2/dist/maplibre-gl.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/tom-select/dist/css/tom-select.default.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/tom-select/dist/js/tom-select.complete.min.js"></script>
    <script src="app.js"></script>
</body>

</html>